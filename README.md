# tinywasm/form
<!-- START_SECTION:BADGES_SECTION -->
<a href="docs/img/badges.svg"><img src="docs/img/badges.svg" alt="Project Badges" title="Generated by devflow from github.com/tinywasm/devflow"></a>
<!-- END_SECTION:BADGES_SECTION -->

Fast form generation from Go structs for TinyGo + WASM. Uses `tinywasm/fmt` exclusively (no standard library).

## Quick Start

```go
type User struct {
    Name  string `placeholder:"Full Name"`
    Email string
    Role  string `options:"admin:Admin,user:User"`
}

f, err := form.New("parent-id", &User{Name: "John"})
html := f.RenderHTML()    // render to HTML string
```

## Public API

### `form.New(parentID string, structPtr any) (*Form, error)`
Creates a `Form` from a struct pointer.
- Reflects exported fields → matches each to a registered `Input` by name/alias
- Copies struct field values into inputs
- Returns error if any exported field has no matching input
- Form `id` = `parentID + "." + lowercase(structName)`
- Default action = `/lowercase(structName)`, method = `POST`

### `form.RegisterInput(inputs ...input.Input)`
Registers custom input types globally. Called with `("", "")` as dummy init args.

### `form.SetGlobalClass(classes ...string)`
Sets CSS classes applied to all `<form>` elements.

### `(*Form) Methods`

| Method | Description |
|--------|-------------|
| `GetID() string` | Returns form's HTML id |
| `SetSSR(bool) *Form` | Enables SSR mode (adds `method`, `action`, `<button type="submit">`) |
| `RenderHTML() string` | Generates form HTML |
| `Validate() error` | Validates all inputs, returns first error |
| `SyncValues() error` | Copies input values back into the source struct |
| `OnSubmit(func(any) error) *Form` | Sets WASM submit callback |
| `OnMount()` | **WASM only** — sets up event delegation |
| `OnUnmount()` | **WASM only** — cleanup (handled by dom) |
| `Input(fieldName string) input.Input` | Returns input for a field name |
| `SetOptions(field string, opts ...fmt.KeyValue) *Form` | Sets options on a field's input |
| `SetValues(field string, values ...string) *Form` | Sets value on a field's input |

### Render Modes

| Mode | `SetSSR` | Output |
|------|----------|--------|
| WASM/Fetch (default) | `false` | `<form id="..."> inputs </form>` |
| SSR | `true` | `<form id="..." method="POST" action="/..."> inputs <button type="submit"> </form>` |

## Struct Tags

| Tag | Format | Description |
|-----|--------|-------------|
| `options` | `"key1:text1,key2:text2"` | Options for select/radio/datalist |
| `placeholder` | `"My placeholder"` | HTML placeholder |
| `title` | `"My tooltip"` | HTML title attribute |
| `validate` | `"false"` | Skip validation for this field |

```go
type User struct {
    Name     string `placeholder:"Full Name" title:"Enter your full name"`
    Role     string `options:"admin:Admin,user:User"`
    Internal string `validate:"false"`
}
```

## Field Matching

`New()` matches each exported struct field to a registered Input:
1. `lowercase(FieldName)` vs Input's `htmlName` or `aliases`
2. `lowercase(StructName.FieldName)` vs Input's `aliases`

Matching is **case-insensitive**. First match wins.

## Input Interface

```go
type Input interface {
    dom.Component  // GetID(), SetID(), RenderHTML(), Children()
    HTMLName() string                  // HTML type ("text", "email", etc.)
    FieldName() string                 // struct field name
    ValidateField(value string) error  // field validation
    Clone(parentID, name string) Input // creates new instance
}
```

## WASM Event Flow

```
dom.Mount("root", myForm)
  → myForm.RenderHTML() injected into DOM
  → myForm.OnMount() called
      → one "input"/"change" listener at <form> level
          → finds input by event.target.id
          → calls SetValues(val) + ValidateField(val)
      → one "submit" listener
          → PreventDefault()
          → SyncValues() → Validate() → OnSubmit callback
```

## Documentation Index
- [Input Types & Base API](input/README.md)
- [API Reference](docs/API.md)
- [Design & Architecture](docs/DESIGN.md)
- [Struct Tags](docs/TAGS.md)
